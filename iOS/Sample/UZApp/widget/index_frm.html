<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, initial-scale=1.0, width=device-width"/>
    <meta name="format-detection" content="telephone=no, email=no, date=no, address=no">
    <title>WinA</title>
    <link rel="stylesheet" type="text/css" href="css/api.css"/>
    <link rel="stylesheet" type="text/css" href="css/box.css"/>
    <script type="text/javascript" src="script/public.js"></script>
    <style>
    	p{
    		color:#999;
    		padding:5px;
    	}



    </style>

    <script type="text/javascript">
        
        var uzmoduleagora = null;
        var clientRole = 1;
        var remoteUid = 0;
        
        apiready = function(){
            uzmoduleagora = api.require('agoraRtc');
        }

        function agoraRtcMethodResultCallback(ret){
            if (ret.code != 0) {
                alert("Call agoraRtc method failed: " + ret.code);
            }
        }

        function init() {
            var param = {appId:"012ac3f2bbad46dfa702e8b2ef628954"};
            uzmoduleagora.init(param);

            setLogFile();
            setLogFilter();
            
            joinChannelSuccessListener();
            firstLocalVideoFrameListener();
            leaveChannelListener();
            remoteUserJoinedListener();
            firstRemoteVideoDecodedListener();
            remoteUserOfflineListener();
            requestTokenListener();
            errorListener();
            warningListener();
            
            uzmoduleagora.enableVideo();
            
            var paramChannelProfile = {profile:1};
            uzmoduleagora.setChannelProfile(paramChannelProfile);
            
            var paramClientRole = {role:clientRole};
            uzmoduleagora.setClientRole(paramClientRole);
            
            var paramVideoProfile = {width:640, height:360, frameRate:15, bitrate:800};
            uzmoduleagora.setVideoProfile(paramVideoProfile);
        }
    
        function getSdkVersion(){
            var resultCallback = function(ret){
                alert(ret);
            }
            uzmoduleagora.getSdkVersion(resultCallback);
        }

        var enableRemoteViewMirror = false;
        function mirrorRemoteView(){
            enableRemoteViewMirror = !enableRemoteViewMirror;
            
            var str = '{"che.video.enableRemoteViewMirror":' + enableRemoteViewMirror + '}';
            api.toast({ msg: str });
            
            var param = {params:str};
            uzmoduleagora.setParameters(param, agoraRtcMethodResultCallback);
        }

        function setLogFile(){
            var param = {path:"cache://agoraRtc.log"};
            uzmoduleagora.setLogFile(param, agoraRtcMethodResultCallback);
        }

        function setLogFilter(){
            var param = {filter:65535};
            uzmoduleagora.setLogFilter(param, agoraRtcMethodResultCallback);
        }

        function joinChannel(){
            if (clientRole == 1) {
                setupLocalVideo();
            }
            
            var param = {channel:"test", uid:0};
            uzmoduleagora.joinChannel(param, agoraRtcMethodResultCallback);
        }

        function leaveChannel(){
            uzmoduleagora.leaveChannel(agoraRtcMethodResultCallback);
        }

        function setClientRole(){
            if (clientRole == 1) {
                clientRole = 2;
                api.toast({ msg: "Set Client Role to Audience" });
            }
            else {
                clientRole = 1;
                api.toast({ msg: "Set Client Role to Broadcaster" });
            }
            
            var param = {role:clientRole};
            var resultCallback = function(ret){
                if (ret.code != 0) {
                    alert("Call agoraRtc method failed: " + ret.code);
                }
                else if (clientRole == 1) {
                    setupLocalVideo();
                }
                else {
                    uzmoduleagora.setupLocalVideo();
                }
            }
            uzmoduleagora.setClientRole(param, resultCallback);
        }

        function renewToken(){
            var param = {token:""};
            uzmoduleagora.renewToken(param);
        }

        function enableVideo(){
            uzmoduleagora.enableVideo(agoraRtcMethodResultCallback);
        }

        function disableVideo(){
            uzmoduleagora.disableVideo(agoraRtcMethodResultCallback);
        }

        var localVideoEnable = true;
        function enableLocalVideo(){
            localVideoEnable = !localVideoEnable;
            if (localVideoEnable) {
                api.toast({ msg: "Enable Local Video" });
            }
            else {
                api.toast({ msg: "Disable Local Video" });
            }
            
            var param = {enabled:localVideoEnable};
            uzmoduleagora.enableLocalVideo(param, agoraRtcMethodResultCallback);
        }

        function setVideoProfile(){
            var param = {width:640, height:360, frameRate:15, bitrate:800};
            uzmoduleagora.setVideoProfile(param);
        }

        function setupLocalVideo(){
            var paramLocalVideoView = {
                rect:{
                    x:0,
                    y:25,
                    w:180,
                    h:320
                },
                fixedOn:'index_frm',
                fixed:false,
                renderMode:1
            };
            uzmoduleagora.setupLocalVideo(paramLocalVideoView);
        }

        function startPreview(){
            setupLocalVideo();
            uzmoduleagora.startPreview(agoraRtcMethodResultCallback);
        }

        function stopPreview(){
            uzmoduleagora.setupLocalVideo();
            uzmoduleagora.stopPreview(agoraRtcMethodResultCallback);
        }

        function switchCamera(){
            uzmoduleagora.switchCamera(agoraRtcMethodResultCallback);
        }

        function setupRemoteVideo(uid){
            var paramRemoteVideoView = {
                uid:uid,
                rect:{
                    x:180,
                    y:25,
                    w:180,
                    h:320
                },
                fixedOn:'index_frm',
                fixed:false,
                renderMode:1
            };
            uzmoduleagora.setupRemoteVideo(paramRemoteVideoView);
        }

        var localVideoMute = false
        function muteLocalVideoStream(){
            localVideoMute = !localVideoMute;
            if (localVideoMute) {
                api.toast({ msg: "Mute Local Video" });
            }
            else {
                api.toast({ msg: "Unmute Local Video" });
            }
            
            var param = {mute:localVideoMute};
            uzmoduleagora.muteLocalVideoStream(param, agoraRtcMethodResultCallback);
        }

        var allRemoteVideoMute = false
        function muteAllRemoteVideoStreams(){
            allRemoteVideoMute = !allRemoteVideoMute;
            if (allRemoteVideoMute) {
                api.toast({ msg: "Mute All Remote Video" });
            }
            else {
                api.toast({ msg: "Unmute All Remote Video" });
            }
            
            var param = {mute:allRemoteVideoMute};
            uzmoduleagora.muteAllRemoteVideoStreams(param, agoraRtcMethodResultCallback);
        }

        var remoteVideoMute = false
        function muteRemoteVideoStream(){
            if (remoteUid == 0) {
                api.toast({ msg: "Remote user is offline" });
            }
            else {
                remoteVideoMute = !remoteVideoMute;
                if (remoteVideoMute) {
                    api.toast({ msg: "Mute Remote Video" });
                }
                else {
                    api.toast({ msg: "Unmute Remote Video" });
                }
                
                var param = {uid:remoteUid,mute:remoteVideoMute};
                uzmoduleagora.muteRemoteVideoStream(param, agoraRtcMethodResultCallback);
            }
        }

        function enableAudio(){
            uzmoduleagora.enableAudio(agoraRtcMethodResultCallback);
        }

        function disableAudio(){
            uzmoduleagora.disableAudio(agoraRtcMethodResultCallback);
        }

        function pauseAudio(){
            uzmoduleagora.pauseAudio(agoraRtcMethodResultCallback);
        }

        function resumeAudio(){
            uzmoduleagora.resumeAudio(agoraRtcMethodResultCallback);
        }

        var localAudioMute = false;
        function muteLocalAudioStream(){
            localAudioMute = !localAudioMute;
            if (localAudioMute) {
                api.toast({ msg: "Mute Local Audio" });
            }
            else {
                api.toast({ msg: "Unmute Local Audio" });
            }
            
            var param = {mute:localAudioMute};
            uzmoduleagora.muteLocalAudioStream(param, agoraRtcMethodResultCallback);
        }

        var allRemoteAudioMute = false
        function muteAllRemoteAudioStreams(){
            allRemoteAudioMute = !allRemoteAudioMute;
            if (allRemoteAudioMute) {
                api.toast({ msg: "Mute All Remote Audio" });
            }
            else {
                api.toast({ msg: "Unmute All Remote Audio" });
            }
            
            var param = {mute:allRemoteAudioMute};
            uzmoduleagora.muteAllRemoteAudioStreams(param, agoraRtcMethodResultCallback);
        }

        var remoteAudioMute = false;
        function muteRemoteAudioStream(){
            if (remoteUid == 0) {
                api.toast({ msg: "Remote user is offline" });
            }
            else {
                remoteAudioMute = !remoteAudioMute;
                if (remoteAudioMute) {
                    api.toast({ msg: "Mute Remote Audio" });
                }
                else {
                    api.toast({ msg: "Unmute Remote Audio" });
                }
                
                var param = {uid:remoteUid,mute:remoteAudioMute};
                uzmoduleagora.muteRemoteAudioStream(param, agoraRtcMethodResultCallback);
            }
        }
    
        function destroy() {
            uzmoduleagora.destroy()
        }

        /**----------- callback methods ----------------**/
        
        function joinChannelSuccessListener(){
            var methodCallback = function(ret){
                var msg = ret.channel + " join success";
                api.toast({ msg: msg });
            }
            uzmoduleagora.joinChannelSuccessListener(methodCallback);
        }
    
        function firstLocalVideoFrameListener(){
            var methodCallback = function(ret){
                var msg = "Local video size: " + ret.width + "x" + ret.height;
                api.toast({ msg: msg });
            }
            uzmoduleagora.firstLocalVideoFrameListener(methodCallback);
        }
    
        function leaveChannelListener(){
            var methodCallback = function(ret){
                uzmoduleagora.setupLocalVideo();
            }
            uzmoduleagora.leaveChannelListener(methodCallback);
        }
    
        function remoteUserJoinedListener(){
            var methodCallback = function(ret){
                remoteUid = ret.uid;
                remoteVideoMute = false;
                remoteAudioMute = false;
                
                setupRemoteVideo(ret.uid);
            }
            uzmoduleagora.remoteUserJoinedListener(methodCallback);
        }
    
        function firstRemoteVideoDecodedListener(){
            var methodCallback = function(ret){
                var msg = "Remote video size: " + ret.width + "x" + ret.height;
                api.toast({ msg: msg });
            }
            uzmoduleagora.firstRemoteVideoDecodedListener(methodCallback);
        }
    
        function remoteUserOfflineListener(){
            var methodCallback = function(ret){
                remoteUid = 0;
                uzmoduleagora.setupRemoteVideo({uid:ret.uid});
            }
            uzmoduleagora.remoteUserOfflineListener(methodCallback);
        }
    
        function requestTokenListener(){
            var methodCallback = function(ret){
                renewToken();
            }
            uzmoduleagora.requestTokenListener(methodCallback);
        }
    
        function errorListener(){
            var methodCallback = function(ret){
                var msg = "Agora rtc error: "+ ret.errorCode;
                api.toast({ msg: msg });
            }
            uzmoduleagora.errorListener(methodCallback);
        }
    
        function warningListener(){
            var methodCallback = function(ret){
                var msg = "Agora rtc warning: "+ ret.warningCode;
                api.toast({ msg: msg });
            }
            uzmoduleagora.warningListener(methodCallback);
        }

    </script>
</head>
<body>
<div id="wrap">
    <div id="main">
        <br>
        <div class="clickbtn" tapmode="active" onclick="init()">Init</div>
        <div class="clickbtn" tapmode="active" onclick="getSdkVersion()">GetSdkVersion</div>
        <br><br>
        <div class="clickbtn" tapmode="active" onclick="startPreview()">Start Preview</div>
        <div class="clickbtn" tapmode="active" onclick="stopPreview()">Stop Preview</div>
        <div class="clickbtn" tapmode="active" onclick="mirrorRemoteView()">Set Private Parameter to Mirror Remove Video</div>
        <div class="clickbtn" tapmode="active" onclick="joinChannel()">Join Channel</div>
        <br><br>
        <div class="clickbtn" tapmode="active" onclick="setClientRole()">Set Client Role</div>
        <div class="clickbtn" tapmode="active" onclick="leaveChannel()">Leave Channel</div>
        <br><br>
        <div class="clickbtn" tapmode="active" onclick="enableVideo()">Enable Video</div>
        <div class="clickbtn" tapmode="active" onclick="disableVideo()">Disable Video</div>
        <div class="clickbtn" tapmode="active" onclick="enableLocalVideo()">Enable Local Video</div>
        <div class="clickbtn" tapmode="active" onclick="switchCamera()">Switch Camera</div>
        <div class="clickbtn" tapmode="active" onclick="muteLocalVideoStream()">Mute Local Video</div>
        <div class="clickbtn" tapmode="active" onclick="muteAllRemoteVideoStreams()">Mute All Remote Video</div>
        <div class="clickbtn" tapmode="active" onclick="muteRemoteVideoStream()">Mute Remote Video</div>
        <br><br>
        <div class="clickbtn" tapmode="active" onclick="enableAudio()">Enable Audio</div>
        <div class="clickbtn" tapmode="active" onclick="disableAudio()">Disable Audio</div>
        <div class="clickbtn" tapmode="active" onclick="pauseAudio()">Pause Audio</div>
        <div class="clickbtn" tapmode="active" onclick="resumeAudio()">Resume Audio</div>
        <div class="clickbtn" tapmode="active" onclick="muteLocalAudioStream()">Mute Local Audio</div>
        <div class="clickbtn" tapmode="active" onclick="muteAllRemoteAudioStreams()">Mute All Remote Audio</div>
        <div class="clickbtn" tapmode="active" onclick="muteRemoteAudioStream()">Mute Remote Audio</div>
        <br><br>
        <div class="clickbtn" tapmode="active" onclick="destroy()">Destroy</div>
        <br>
    </div>
</div>
</body>
</html>
